config:
  description: changing ACLs for a topic triggers deletion of invalid ACLs, creation of new ones, and not touching valid ones
  projects:
    - nav-integration-test

aiven:
  existing:
    acls:
      - id: acl-1
        username: myteam.myapplication*
        permission: read
        topic: myteam.mytopic
      - id: acl-2
        username: otherteam.otherapplication*
        permission: write
        topic: myteam.mytopic
      - id: acl-3
        username: myteam.no-wildcard-680515dc
        permission: readwrite
        topic: myteam.mytopic
    serviceusers:
      - username: myteam.myapplication-6580c2d3
      - username: otherteam.otherapplication-fb9c8478
      - username: myteam.no-wildcard-680515dc
    topics:
      - topic_name: myteam.mytopic
    service:
      name: nav-integration-test
      service_uri: well-known-kafka-brokers:12345
      components:
        - component: kafka
          host: kafka-host.tld
          port: 123
        - component: schema_registry
          host: schema-registry.tld
          port: 9876
    ca: well-known-certificate-authority
  created:
    serviceusers:
      - username: myteam.myapplication-6580c2d3
      - username: otherteam.otherapplication-fb9c8478
      - username: too-long-team.too-long-applicat-eacc7bda
    topics: []
    acls:
      - username: too-long-team.too-long-applicat*
        permission: read
        topic: myteam.mytopic
      - username: myteam.myapplication*
        permission: readwrite
        topic: myteam.mytopic
      - username: myteam.no-wildcard*
        permission: readwrite
        topic: myteam.mytopic
  updated:
    topics: {}
  deleted:
    acls:
      - acl-1
      - acl-3

topic:
  apiVersion: kafka.nais.io/v1
  kind: Topic
  metadata:
    name: mytopic
    namespace: myteam
    labels:
      team: myteam
  spec:
    pool: nav-integration-test
    acl:
      - access: write
        team: otherteam
        application: otherapplication
      - access: readwrite
        team: myteam
        application: myapplication
      - access: read
        team: too-long-team
        application: too-long-application
      - access: readwrite
        team: myteam
        application: no-wildcard

output:
  status:
    synchronizationState: RolloutComplete
    message: Topic configuration synchronized to Kafka pool
    fullyQualifiedName: myteam.mytopic
  secrets:
    - apiVersion: v1
      kind: Secret
      type: Opaque
      metadata:
        name: kafka-otherapplication-nav-integration-test-5ed2b9b5
        namespace: otherteam
        labels:
          aivenator.aiven.nais.io/migration: "true"
          app: otherapplication
          team: otherteam
          type: aivenator.aiven.nais.io
        annotations:
          aivenator.aiven.nais.io/protected: "true"
          kafka.aiven.nais.io/pool: nav-integration-test
          kafka.aiven.nais.io/serviceUser: otherteam.otherapplication-fb9c8478
          kafka.nais.io/application: otherapplication
          kafka.nais.io/pool: nav-integration-test
        finalizers:
          - aivenator.aiven.nais.io/finalizer
      data:
        client.keystore.p12: d2VsbC1rbm93bi1rZXlzdG9yZQ==    # well-known-keystore
        client.truststore.jks: d2VsbC1rbm93bi10cnVzdHN0b3Jl  # well-known-truststore
      stringData:
        KAFKA_BROKERS: well-known-kafka-brokers:12345
        KAFKA_CA: well-known-certificate-authority
        KAFKA_CERTIFICATE: well-known-access-cert
        KAFKA_PRIVATE_KEY: well-known-access-key
        KAFKA_CREDSTORE_PASSWORD: changeme
        KAFKA_SCHEMA_REGISTRY: https://schema-registry.tld:9876
        KAFKA_SCHEMA_REGISTRY_USER: otherteam.otherapplication-fb9c8478
        KAFKA_SCHEMA_REGISTRY_PASSWORD: well-known-password
        KAFKA_SECRET_UPDATED: 1970-01-01T00:00:00Z
    - apiVersion: v1
      kind: Secret
      type: Opaque
      metadata:
        name: kafka-myapplication-nav-integration-test-42edfcd6
        namespace: myteam
        labels:
          aivenator.aiven.nais.io/migration: "true"
          app: myapplication
          team: myteam
          type: aivenator.aiven.nais.io
        annotations:
          aivenator.aiven.nais.io/protected: "true"
          kafka.aiven.nais.io/pool: nav-integration-test
          kafka.aiven.nais.io/serviceUser: myteam.myapplication-6580c2d3
          kafka.nais.io/application: myapplication
          kafka.nais.io/pool: nav-integration-test
        finalizers:
          - aivenator.aiven.nais.io/finalizer
      data:
        client.keystore.p12: d2VsbC1rbm93bi1rZXlzdG9yZQ==    # well-known-keystore
        client.truststore.jks: d2VsbC1rbm93bi10cnVzdHN0b3Jl  # well-known-truststore
      stringData:
        KAFKA_BROKERS: well-known-kafka-brokers:12345
        KAFKA_CA: well-known-certificate-authority
        KAFKA_CERTIFICATE: well-known-access-cert
        KAFKA_PRIVATE_KEY: well-known-access-key
        KAFKA_CREDSTORE_PASSWORD: changeme
        KAFKA_SCHEMA_REGISTRY: https://schema-registry.tld:9876
        KAFKA_SCHEMA_REGISTRY_USER: myteam.myapplication-6580c2d3
        KAFKA_SCHEMA_REGISTRY_PASSWORD: well-known-password
        KAFKA_SECRET_UPDATED: 1970-01-01T00:00:00Z
    - apiVersion: v1
      kind: Secret
      type: Opaque
      metadata:
        name: kafka-too-long-application-nav-integration-test-e0bd18b9
        namespace: too-long-team
        labels:
          aivenator.aiven.nais.io/migration: "true"
          app: too-long-application
          team: too-long-team
          type: aivenator.aiven.nais.io
        annotations:
          aivenator.aiven.nais.io/protected: "true"
          kafka.aiven.nais.io/pool: nav-integration-test
          kafka.aiven.nais.io/serviceUser: too-long-team.too-long-applicat-eacc7bda
          kafka.nais.io/application: too-long-application
          kafka.nais.io/pool: nav-integration-test
        finalizers:
          - aivenator.aiven.nais.io/finalizer
      data:
        client.keystore.p12: d2VsbC1rbm93bi1rZXlzdG9yZQ==    # well-known-keystore
        client.truststore.jks: d2VsbC1rbm93bi10cnVzdHN0b3Jl  # well-known-truststore
      stringData:
        KAFKA_BROKERS: well-known-kafka-brokers:12345
        KAFKA_CA: well-known-certificate-authority
        KAFKA_CERTIFICATE: well-known-access-cert
        KAFKA_PRIVATE_KEY: well-known-access-key
        KAFKA_CREDSTORE_PASSWORD: changeme
        KAFKA_SCHEMA_REGISTRY: https://schema-registry.tld:9876
        KAFKA_SCHEMA_REGISTRY_USER: too-long-team.too-long-applicat-eacc7bda
        KAFKA_SCHEMA_REGISTRY_PASSWORD: well-known-password
        KAFKA_SECRET_UPDATED: 1970-01-01T00:00:00Z
    - apiVersion: v1
      kind: Secret
      type: Opaque
      metadata:
        name: kafka-no-wildcard-nav-integration-test-104cf1ba
        namespace: myteam
        labels:
          aivenator.aiven.nais.io/migration: "true"
          app: no-wildcard
          team: myteam
          type: aivenator.aiven.nais.io
        annotations:
          aivenator.aiven.nais.io/protected: "true"
          kafka.aiven.nais.io/pool: nav-integration-test
          kafka.aiven.nais.io/serviceUser: myteam.no-wildcard-680515dc
          kafka.nais.io/application: no-wildcard
          kafka.nais.io/pool: nav-integration-test
        finalizers:
          - aivenator.aiven.nais.io/finalizer
      data:
        client.keystore.p12: d2VsbC1rbm93bi1rZXlzdG9yZQ==    # well-known-keystore
        client.truststore.jks: d2VsbC1rbm93bi10cnVzdHN0b3Jl  # well-known-truststore
      stringData:
        KAFKA_BROKERS: well-known-kafka-brokers:12345
        KAFKA_CA: well-known-certificate-authority
        KAFKA_CERTIFICATE: well-known-access-cert
        KAFKA_PRIVATE_KEY: well-known-access-key
        KAFKA_CREDSTORE_PASSWORD: changeme
        KAFKA_SCHEMA_REGISTRY: https://schema-registry.tld:9876
        KAFKA_SCHEMA_REGISTRY_USER: myteam.no-wildcard-680515dc
        KAFKA_SCHEMA_REGISTRY_PASSWORD: well-known-password
        KAFKA_SECRET_UPDATED: 1970-01-01T00:00:00Z
